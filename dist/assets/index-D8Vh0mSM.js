(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const St="https://metrorail-next-train-default-rtdb.firebaseio.com/schedules.json";let dt={};const It=6;let N="pta-pien",k=null,g={},re=[],me=null,J="weekday",ct=0,ye,F={};const ge={standardInterval:300*1e3,nightModeStart:21,nightModeEnd:4};let fe=null,Te,ie=0,ve=null,ee=!1,ut="",ft=1;const $={"pta-pien":{id:"pta-pien",name:"Pretoria <-> Pienaarspoort",colorClass:"text-green-500",isActive:!0,destA:"PRETORIA STATION",destB:"PIENAARSPOORT STATION",transferStation:"KOEDOESPOORT STATION",sheetKeys:{weekday_to_a:"pien_to_pta_weekday",weekday_to_b:"pta_to_pien_weekday",saturday_to_a:"pien_to_pta_sat",saturday_to_b:"pta_to_pien_sat"}},"pta-mabopane":{id:"pta-mabopane",name:"Pretoria <-> Mabopane",colorClass:"text-orange-500",isActive:!0,destA:"PRETORIA STATION",destB:"MABOPANE STATION",transferStation:null,sheetKeys:{weekday_to_a:"mab_to_pta_weekday",weekday_to_b:"pta_to_mab_weekday",saturday_to_a:"mab_to_pta_sat",saturday_to_b:"pta_to_mab_sat"}},"pta-saul":{id:"pta-saul",name:"Pretoria <-> Saulsville",colorClass:"text-green-500",isActive:!1,destA:"PRETORIA STATION",destB:"SAULSVILLE STATION",transferStation:null,sheetKeys:{}},"germ-leralla":{id:"germ-leralla",name:"Germiston <-> Leralla",colorClass:"text-blue-500",isActive:!0,destA:"GERMISTON STATION",destB:"LERALLA STATION",transferStation:null,sheetKeys:{weekday_to_a:"lerl_to_germ_weekday",weekday_to_b:"germ_to_lerl_weekday",saturday_to_a:"lerl_to_germ_sat",saturday_to_b:"germ_to_lerl_sat"}},"pta-irene":{id:"pta-irene",name:"Pretoria <-> Irene",colorClass:"text-blue-500",isActive:!1,destA:"PRETORIA STATION",destB:"IRENE STATION",transferStation:null,sheetKeys:{}},"pta-kempton":{id:"pta-kempton",name:"Pretoria <-> Kempton Park",colorClass:"text-blue-500",isActive:!1,destA:"PRETORIA STATION",destB:"KEMPTON PARK STATION",transferStation:null,sheetKeys:{}},"pta-germiston":{id:"pta-germiston",name:"Pretoria <-> Germiston",colorClass:"text-blue-500",isActive:!1,destA:"PRETORIA STATION",destB:"GERMISTON STATION",transferStation:null,sheetKeys:{}},"jhb-vereeniging":{id:"jhb-vereeniging",name:"JHB <-> Vereeniging",colorClass:"text-purple-500",isActive:!1,destA:"JOHANNESBURG STATION",destB:"VEREENIGING STATION",transferStation:null,sheetKeys:{}},"jhb-springs":{id:"jhb-springs",name:"JHB <-> Springs",colorClass:"text-red-500",isActive:!1,destA:"JOHANNESBURG STATION",destB:"SPRINGS STATION",transferStation:null,sheetKeys:{}},"jhb-soweto":{id:"jhb-soweto",name:"JHB <-> Naledi",colorClass:"text-yellow-500",isActive:!1,destA:"JOHANNESBURG STATION",destB:"NALEDI STATION",transferStation:null,sheetKeys:{}}},kt={terms:`
        <h4 class="font-bold text-lg mb-2">1. Independent Service</h4>
        <p><strong>Metrorail Next Train</strong> is an independent project by Kazembe CodeWorks. We are <strong>not affiliated</strong> with PRASA or Metrorail.</p>
        <h4 class="font-bold text-lg mb-2 mt-4">2. Accuracy</h4>
        <p>Schedules are estimated. We are not liable for missed trains or schedule changes.</p>
        <h4 class="font-bold text-lg mb-2 mt-4">3. Usage</h4>
        <p>By using this app, you agree not to misuse the service or scrape data maliciously.</p>
    `,privacy:`
        <h4 class="font-bold text-lg mb-2">1. Data Collection</h4>
        <p>We use Google Analytics to understand app usage anonymously.</p>
        <h4 class="font-bold text-lg mb-2 mt-4">2. Location Services</h4>
        <p>We may request your Location permission to identify your nearest station. This data is processed on your device and is not stored on our servers for tracking.</p>
        <h4 class="font-bold text-lg mb-2 mt-4">3. Third Parties</h4>
        <p>We use Firebase and Google Sheets to store schedule data.</p>
    `};let p,b,S,U,K,Ae,_e,I,A,z,C,Oe,W,Be,Me,V,De,le,de,Ce,Q,X,Re,Y,_,G,$e,He,Pe,Je,te,R,Fe,Ue,ce,Z,L,ue,Ke,j,xe,et,he,tt,be,Se,M,D,Ie,ke,B,Ge,qe,we,Le;function v(t){return t?String(t).replace(/[&<>"']/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]}):""}function Ne(t){return t.toString().padStart(2,"0")}function se(t){return t*(Math.PI/180)}function x(t,e="info",n=3e3){Te&&clearTimeout(Te),L&&(L.textContent=t,L.className="toast-info",e==="success"?L.classList.add("toast-success"):e==="error"&&L.classList.add("toast-error"),L.classList.add("show"),Te=setTimeout(()=>{L.classList.remove("show")},n))}function nt(t){const e=document.createElement("textarea");e.value=t,e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")&&x("Link copied to clipboard!","success",2e3)}catch{}document.body.removeChild(e)}function wt(t,e){try{const n={timestamp:Date.now(),data:e};localStorage.setItem(t,JSON.stringify(n))}catch{}}function at(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch{return null}}function E(t){return t?t.toUpperCase().replace(/ STATION/g,"").trim():""}function mt(){fe&&clearTimeout(fe),ze()}function ze(){if(document.hidden)return;const t=new Date().getHours();if(t>=ge.nightModeStart||t<ge.nightModeEnd){fe=setTimeout(ze,3600*1e3);return}let e=ge.standardInterval;fe=setTimeout(async()=>{await ne(),ze()},e)}document.addEventListener("visibilitychange",()=>{document.hidden||(ne(),mt())});async function ne(t=!1){try{const e=$[N];if(!e)return;if(ce&&(ce.textContent=e.name,ce.className=`text-lg font-medium ${e.colorClass} group-hover:opacity-80 transition-colors`),U&&(U.innerHTML=`Next train to <span class="text-blue-500 dark:text-blue-400">${e.destA.replace(" STATION","")}</span>`),K&&(K.innerHTML=`Next train to <span class="text-blue-500 dark:text-blue-400">${e.destB.replace(" STATION","")}</span>`),pt(),z&&(z.style.display="none"),Ze(),!e.isActive){vt(e.name),A.style.display="block",I.style.display="none";return}const n=at("full_db");let r=!1;if(n&&(console.log("Restoring from cache..."),k=n.data,rt(e),k.lastUpdated&&j&&(j.textContent=`Schedule updated: ${k.lastUpdated}`),it(),r=!0),!r&&I&&(I.style.display="flex"),_){const c=_.querySelector("svg");c&&c.classList.add("spinning"),_.disabled=!0}const a=await fetch(St);if(!a.ok)throw new Error("Firebase fetch failed");const i=await a.json();if(!i)throw new Error("Empty database");const s=JSON.stringify(i),o=n?JSON.stringify(n.data):"";s!==o?(console.log("New data! Updating..."),k=i,wt("full_db",k),rt(e),k.lastUpdated&&j&&(j.textContent=`Schedule updated: ${k.lastUpdated}`),r?(x("Schedule updated!","success",3e3),ae()):it()):console.log("Data is up to date.")}catch(e){console.error("Fetch Error:",e),at("full_db")?z&&(z.style.display="block"):Lt()}finally{if(_){_.disabled=!1;const e=_.querySelector("svg");e&&e.classList.remove("spinning")}I&&(I.style.display="none"),A&&(A.style.display="block")}}function rt(t){k&&(g={weekday_to_a:oe(k[t.sheetKeys.weekday_to_a]),weekday_to_b:oe(k[t.sheetKeys.weekday_to_b]),saturday_to_a:oe(k[t.sheetKeys.saturday_to_a]),saturday_to_b:oe(k[t.sheetKeys.saturday_to_b])})}function oe(t){try{if(!t||!Array.isArray(t)||t.length===0)return{headers:[],rows:[],stationColumnName:"STATION"};let e=-1,n="STATION";for(let s=0;s<Math.min(t.length,5);s++){if(t[s].STATION){e=-1;break}if(Object.values(t[s]).includes("STATION")){e=s;break}}const r=t.filter(s=>{const o=s[n];if(!o||typeof o!="string")return!1;const c=o.toLowerCase().trim();return!(c.startsWith("last updated")||c.includes("inter-station")||c.includes("trip"))});if(r.forEach(s=>{if(s.STATION&&s.COORDINATES)try{const o=String(s.COORDINATES).split(",").map(c=>parseFloat(c.trim()));o.length===2&&!isNaN(o[0])&&!isNaN(o[1])&&(dt[s.STATION]={lat:o[0],lon:o[1]})}catch{}}),r.length===0)return{headers:[],rows:[],stationColumnName:"STATION"};const a=new Set;return r.forEach(s=>{Object.keys(s).forEach(o=>{o!=="STATION"&&o!=="COORDINATES"&&o!=="row_index"&&a.add(o)})}),{stationColumnName:"STATION",headers:["STATION",...Array.from(a).sort()],rows:r}}catch(e){return console.error("Parser Error:",e),{headers:[],rows:[],stationColumnName:"STATION"}}}function Lt(t){const e='<div class="text-center p-4 bg-red-100 dark:bg-red-900 rounded-md border border-red-400 dark:border-red-700"><div class="text-2xl mb-2">‚ö†Ô∏è</div><p class="text-red-800 dark:text-red-200 font-medium">Connection failed. Please check internet.</p></div>';b&&(b.innerHTML=e),S&&(S.innerHTML=e),p&&(p.innerHTML="<option>Unable to load stations</option>")}function it(){Nt(),Et(),ae(),I&&(I.style.display="none"),A&&(A.style.display="block")}function Nt(){const t=new Set,e=r=>Object.keys(r).some(i=>i!=="STATION"&&i!=="COORDINATES"&&r[i]&&r[i].trim()!=="");if(g.weekday_to_a&&g.weekday_to_a.rows&&g.weekday_to_a.rows.forEach(r=>{e(r)&&t.add(r.STATION)}),g.weekday_to_b&&g.weekday_to_b.rows&&g.weekday_to_b.rows.forEach(r=>{e(r)&&t.add(r.STATION)}),g.saturday_to_a&&g.saturday_to_a.rows&&g.saturday_to_a.rows.forEach(r=>{e(r)&&t.add(r.STATION)}),g.saturday_to_b&&g.saturday_to_b.rows&&g.saturday_to_b.rows.forEach(r=>{e(r)&&t.add(r.STATION)}),re=Array.from(t),g.weekday_to_a.rows){const r=g.weekday_to_a.rows.map(a=>a.STATION);re.sort((a,i)=>r.indexOf(a)-r.indexOf(i))}const n=p?p.value:"";p&&(p.innerHTML='<option value="">Select a station...</option><option value="FIND_NEAREST">üìç Find Nearest Station</option>',re.forEach(r=>{if(r&&!r.toLowerCase().includes("last updated")){const a=document.createElement("option");a.value=r,a.textContent=r.replace(/ STATION/g,""),p.appendChild(a)}}),re.includes(n)?p.value=n:p.value="")}function Et(){We(),setInterval(We,1e3)}function We(){let t,e;if(ee)t=parseInt(ft),e=ut;else{const a=new Date;t=a.getDay(),e=`${Ne(a.getHours())}:${Ne(a.getMinutes())}:${Ne(a.getSeconds())}`}me=e,Ae&&(Ae.textContent=`Current Time: ${e} ${ee?"(SIM)":""}`),J=t===0?"sunday":t===6?"saturday":"weekday",ct=t;const r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];_e&&(_e.textContent=J==="sunday"?"Sunday (No Service)":`${r[t]} (${J==="saturday"?"Saturday Schedule":"Weekday Schedule"})`),ae()}function Qe(t,e=0){try{if(!t||typeof t!="string")return"";const[n,r,a]=me.split(":").map(Number),i=t.split(":").map(Number);if(i.length<2)return"";const s=i[0],o=i[1],c=i[2]||0;let l=n*3600+r*60+a,u=s*3600+o*60+c-l+e*86400;if(u<-30)return"";if(u<60)return"(Arriving now)";let d=Math.ceil(u/60);const m=Math.floor(d/60),y=d%60;return m>0?`(in ${m}h ${y}m)`:`(in ${y}m)`}catch{return""}}function h(t){try{if(!t)return 0;const e=t.split(":").map(Number),n=e[0]||0,r=e[1]||0,a=e[2]||0;return n*3600+r*60+a}catch{return 0}}function pt(){const t='<div class="h-32 flex flex-col justify-center items-center text-gray-400 dark:text-gray-500"><svg class="w-8 h-8 mb-1 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><span class="text-sm font-medium">Select a station above</span></div>';b&&(b.innerHTML=t),S&&(S.innerHTML=t)}function yt(){if(!navigator.geolocation){x("Geolocation is not supported by your browser.","error"),p&&(p.value="");return}x("Locating nearest station...","info",4e3),navigator.geolocation.getCurrentPosition(t=>{const e=t.coords.latitude,n=t.coords.longitude;let r=null,a=1/0;for(const[i,s]of Object.entries(dt)){const o=At(e,n,s.lat,s.lon);o<a&&(a=o,r=i)}r&&a<=It?(p&&(p.value=r),ae(),x(`Found: ${r.replace(" STATION","")} (${a.toFixed(1)}km)`,"success")):(x("No stations found within 6km.","error"),p&&(p.value=""))},t=>{let e="Unable to retrieve location.";t.code===1&&(e="Location permission denied."),x(e,"error"),p&&(p.value="")})}function At(t,e,n,r){const i=se(n-t),s=se(r-e),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(se(t))*Math.cos(se(n))*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}function ae(){if(!p)return;const t=p.value,e=$[N];if(t==="FIND_NEAREST"){yt();return}if(!e)return;if(!e.isActive){vt(e.name);return}if(b&&(b.innerHTML=""),S&&(S.innerHTML=""),U&&(U.innerHTML=`Next train to <span class="text-blue-500 dark:text-blue-400">${e.destA.replace(" STATION","")}</span>`),K&&(K.innerHTML=`Next train to <span class="text-blue-500 dark:text-blue-400">${e.destB.replace(" STATION","")}</span>`),!t){pt();return}if(p.options[p.selectedIndex].textContent.includes("(No Service)")){const a='<div class="h-32 flex flex-col justify-center items-center text-xl font-bold text-gray-600 dark:text-gray-400">No trains stop here.</div>';b&&(b.innerHTML=a),S&&(S.innerHTML=a);return}if(J==="sunday"){ot(b,e.destA),ot(S,e.destB);return}const n=a=>a?a.toUpperCase().replace(/ STATION/g,"").trim():"",r=(a,i)=>n(a)===n(i);if(r(t,e.destA))Ve(b);else{const a=J==="weekday"?g.weekday_to_a:g.saturday_to_a,{allJourneys:i}=Xe(t,"00:00:00",a,e);st(i,b,U,e.destA)}if(r(t,e.destB))Ve(S);else{const a=J==="weekday"?g.weekday_to_b:g.saturday_to_b,{allJourneys:i}=Ye(t,"00:00:00",a,e);st(i,S,K,e.destB)}}function Xe(t,e,n,r){const{allJourneys:a}=gt(t,n,r.destA);let i=[];if(r.transferStation){const{allJourneys:l}=Tt(t,n,r.transferStation,r.destA);i=l}const s=new Set(i.map(l=>l.train1.train)),c=[...a.filter(l=>!s.has(l.train)),...i];return c.sort((l,f)=>{const u=h(l.departureTime||l.train1.departureTime),d=h(f.departureTime||f.train1.departureTime);return u!==d?u-d:l.type==="transfer"&&f.type==="direct"?-1:l.type==="direct"&&f.type==="transfer"?1:0}),{allJourneys:c}}function Ye(t,e,n,r){const{allJourneys:a}=gt(t,n,r.destB);let i=[];if(r.transferStation){const{allJourneys:l}=Tt(t,n,r.transferStation,r.destB);i=l}const s=new Set(i.map(l=>l.train1.train)),c=[...a.filter(l=>!s.has(l.train)),...i];return c.sort((l,f)=>{const u=h(l.departureTime||l.train1.departureTime),d=h(f.departureTime||f.train1.departureTime);return u!==d?u-d:l.type==="transfer"&&f.type==="direct"?-1:l.type==="direct"&&f.type==="transfer"?1:0}),{allJourneys:c}}function gt(t,e,n){if(!e||!e.rows||e.rows.length===0)return{allJourneys:[]};const r=e.stationColumnName,a=e.headers.slice(1);let i=[];for(const s of a){if(!s||s==="")continue;const o=e.rows.find(d=>d[r]===t),c=o?o[s]:null;if(!c)continue;let l=null,f=null,u=null;for(let d=e.rows.length-1;d>=0;d--){const m=e.rows[d][s];if(m){l=e.rows[d][r],f=m,u=e.rows[d];break}}if(o&&u){const d=e.rows.indexOf(o),m=e.rows.indexOf(u);d<m&&i.push({type:"direct",train:s,departureTime:c,arrivalTime:f,actualDestination:l})}}return i.sort((s,o)=>h(s.departureTime)-h(o.departureTime)),{allJourneys:i}}function Tt(t,e,n,r){if(!e||!e.rows||e.rows.length===0)return{allJourneys:[]};const a=e.stationColumnName,i=e.headers.slice(1);let s=[];const o=d=>e.rows.find(m=>E(m[a])===E(d)),c=o(t),l=o(n);if(!c||!l)return{allJourneys:[]};const f=e.rows.indexOf(c),u=e.rows.indexOf(l);if(f>=u)return{allJourneys:[]};for(const d of i){if(!d||d==="")continue;const m=c[d],y=l[d];if(!m||!y)continue;const T=o(r);if(!(T?T[d]:null)){const w=_t(y,e,n,r,d);w&&w.earliest&&s.push({type:"transfer",train1:{train:d,departureTime:m,arrivalAtTransfer:y,terminationStation:n},connection:w.earliest,nextFullJourney:w.fullJourney})}}return{allJourneys:s}}function _t(t,e,n,r,a){const i=e.stationColumnName,s=e.headers.slice(1);let o=[];const l=(y=>e.rows.find(T=>E(T[i])===E(y)))(n);if(!l)return null;const f=e.rows.indexOf(l),u=h(t);for(const y of s){if(!y||y===""||y===a)continue;const T=l[y];if(!T||h(T)<u)continue;let H=!1,w=n,P=T;for(let O=f+1;O<e.rows.length;O++){const q=e.rows[O][y];q&&(H=!0,w=e.rows[O][i],P=q)}H&&o.push({train:y,departureTime:T,arrivalTime:P,actualDestination:w,connectionStation:n})}if(o.length===0)return null;o.sort((y,T)=>h(y.departureTime)-h(T.departureTime));const d=o[0];let m=null;return E(d.actualDestination)!==E(r)&&(m=o.find(y=>E(y.actualDestination)===E(r))||null),{earliest:d,fullJourney:m}}function st(t,e,n,r){const a=h(me),i=t.filter(c=>h(c.departureTime||c.train1.departureTime)>=a),s=i.length>0?i[0]:null,o=t.length>0?t[0].train||t[0].train1.train:null;if(F||(F={}),F[r]=t,s){const c=s.train||s.train1.train;s.isFirstTrain=c===o;const l=new Set(i.map(f=>f.train||f.train1.train));s.isLastTrain=l.size===1}else if(t.length===0){e&&(e.innerHTML='<div class="h-32 flex flex-col justify-center items-center text-xl font-bold text-gray-600 dark:text-gray-400">No scheduled trains from this station today.</div>');return}Ot(e,n,s,o,r)}function Ot(t,e,n,r,a){if(!t)return;if(t.innerHTML="",!n){Bt(t,a);return}let i="bg-gray-200 dark:bg-gray-900";n.isLastTrain?i="bg-red-100 dark:bg-red-900 border-2 border-red-500":n.isFirstTrain&&(i="bg-green-100 dark:bg-green-900 border-2 border-green-500");const s=v(n.departureTime||n.train1.departureTime),o=v(n.train||n.train1.train),c=v(a),l=Qe(n.departureTime||n.train1.departureTime),u=`<button onclick="window.openScheduleModal('${c.replace(/'/g,"\\'")}')" class="absolute bottom-0 left-0 w-full text-[10px] uppercase tracking-wide font-bold py-1 bg-black bg-opacity-10 hover:bg-opacity-20 dark:bg-white dark:bg-opacity-10 dark:hover:bg-opacity-20 rounded-b-md transition-colors truncate">See Full Schedule</button>`;if(n.type==="direct"){const d=n.actualDestination?E(n.actualDestination):"",m=E(a);let y=n.arrivalTime?`Arrives ${v(n.arrivalTime)}`:"Arrival time not available.";d&&m&&d!==m&&(y=`Terminates at ${v(n.actualDestination.replace(/ STATION/g,""))}.`);let T=`<span class="font-bold text-yellow-600 dark:text-yellow-400">Direct train (${o})</span>`;n.isLastTrain&&(T=`<span class="font-bold text-red-600 dark:text-red-400">Last Direct train (${o})</span>`),t.innerHTML=`<div class="flex flex-row items-center w-full space-x-3"><div class="relative w-1/2 h-32 flex flex-col justify-center items-center text-center p-2 pb-6 ${i} rounded-lg shadow-sm flex-shrink-0"><div class="text-3xl font-bold text-gray-900 dark:text-white">${s}</div><div class="text-sm text-gray-700 dark:text-gray-300 font-medium mt-1">${l}</div>${u}</div><div class="w-1/2 flex flex-col justify-center items-center text-center space-y-1"><div class="text-sm text-gray-800 dark:text-gray-200 font-medium leading-tight">${T}</div><div class="text-xs text-gray-500 dark:text-gray-400 leading-tight font-medium">${y}</div></div></div>`}if(n.type==="transfer"){const d=n.connection,m=n.nextFullJourney,y=v(n.train1.terminationStation.replace(/ STATION/g,"")),T=v(n.train1.arrivalAtTransfer);let H=`Train ${o} (Terminates at ${y} at ${T})`;n.isLastTrain&&(H=`<span class="text-red-600 dark:text-red-400 font-bold">Last Train (${o})</span> (Terminates at ${y})`);let w="";if(m){const P=v(d.train),O=v(d.actualDestination.replace(/ STATION/g,"")),q=v(d.departureTime),pe=v(m.train),je=v(m.actualDestination.replace(/ STATION/g,"")),xt=v(m.departureTime),ht=`Connect to Train ${P} (to ${O}) at <b>${q}</b>`,bt=`Next Train ${pe} (to ${je}) is at <b>${xt}</b>`;w=`<div class="space-y-1"><div class="text-yellow-600 dark:text-yellow-400 font-medium">${ht}</div><div class="text-gray-500 dark:text-gray-400 text-xs font-medium">${bt}</div></div>`}else{const P=v(d.train),O=v(d.departureTime);let pe=`(Arrives ${v(d.arrivalTime)})`;w=`<div class="text-yellow-600 dark:text-yellow-400 font-medium">${`Connect to Train ${P} at <b>${O}</b> ${pe}`}</div>`}t.innerHTML=`<div class="flex flex-row items-center w-full space-x-3"><div class="relative w-1/2 h-32 flex flex-col justify-center items-center text-center p-2 pb-6 ${i} rounded-lg shadow-sm flex-shrink-0"><div class="text-3xl font-bold text-gray-900 dark:text-white">${s}</div><div class="text-sm text-gray-700 dark:text-gray-300 font-medium mt-1">${l}</div>${u}</div><div class="w-1/2 flex flex-col justify-center items-center text-center space-y-1"><div class="text-sm font-bold text-red-600 dark:text-red-400 uppercase tracking-wider mb-1">Transfer Required</div><div class="text-xs text-yellow-600 dark:text-yellow-400 leading-tight font-medium">${H}</div><div class="text-xs leading-tight">${w}</div></div></div>`}}function Bt(t,e){if(!t)return;const n=$[N];let r="",a="",i=1;switch(ct){case 6:r="Monday",i=2,a=e===n.destA?"weekday_to_a":"weekday_to_b";break;case 5:r="Saturday",i=1,a=e===n.destA?"saturday_to_a":"saturday_to_b";break;default:r="tomorrow",i=1,a=e===n.destA?"weekday_to_a":"weekday_to_b";break}const s=g[a];if(!s){t.innerHTML='<div class="h-32 flex flex-col justify-center items-center text-xl font-bold text-gray-600 dark:text-gray-400">No schedule found for next service day.</div>';return}const o=p.value;let c=[];e===n.destA?c=Xe(o,"00:00:00",s,n).allJourneys:c=Ye(o,"00:00:00",s,n).allJourneys;const l=c.filter(m=>h(m.departureTime||m.train1.departureTime)>=0),f=l.length>0?l[0]:null;if(!f){t.innerHTML=`<div class="h-32 flex flex-col justify-center items-center text-xl font-bold text-gray-600 dark:text-gray-400">No trains found for ${r}.</div>`;return}const u=f.departureTime||f.train1.departureTime,d=Qe(u,i);t.innerHTML=`<div class="h-32 flex flex-col justify-center items-center w-full"><div class="text-lg font-bold text-gray-600 dark:text-gray-400">No more trains today</div><p class="text-sm text-gray-400 dark:text-gray-500 mt-2">First train ${r} is at:</p><div class="text-center p-3 bg-gray-200 dark:bg-gray-900 rounded-md transition-all mt-2 w-3/4"><div class="text-2xl font-bold text-gray-900 dark:text-white">${u}</div><div class="text-base text-gray-700 dark:text-gray-300 font-medium">${d}</div></div></div>`}function Ve(t){t&&(t.innerHTML='<div class="h-32 flex flex-col justify-center items-center text-xl font-bold text-green-500 dark:text-green-400">You are at this station</div>')}function ot(t,e){if(!t)return;const n=u=>u?u.toUpperCase().replace(/ STATION/g,"").trim():"",r=p.value;if(n(r)===n(e)){Ve(t);return}const a=$[N],i=e===a.destA?"weekday_to_a":"weekday_to_b",s=g[i];let o=[];e===a.destA?o=Xe(r,"00:00:00",s,a).allJourneys:o=Ye(r,"00:00:00",s,a).allJourneys;const c=o.filter(u=>h(u.departureTime||u.train1.departureTime)>=0),l=c.length>0?c[0]:null;let f="N/A";if(l){const u=l.departureTime||l.train1.departureTime,d=Qe(u,1);f=`<div class="text-2xl font-bold text-gray-900 dark:text-white">${u}</div><div class="text-base text-gray-700 dark:text-gray-300 font-medium">${d}</div>`}t.innerHTML=`<div class="h-32 flex flex-col justify-center items-center w-full"><div class="text-xl font-bold text-gray-600 dark:text-gray-400">No service on Sundays.</div><p class="text-sm text-gray-400 dark:text-gray-500 mt-2">First train Monday is at:</p><div class="text-center p-3 bg-gray-200 dark:bg-gray-900 rounded-md transition-all mt-2 w-3/4">${f}</div></div>`}function vt(t){const e=`<div class="h-32 flex flex-col justify-center items-center text-center p-6 bg-yellow-100 dark:bg-yellow-900 rounded-lg"><h3 class="text-xl font-bold text-yellow-700 dark:text-yellow-300 mb-2">üöß Coming Soon</h3><p class="text-gray-700 dark:text-gray-300">We are working on the <strong>${t}</strong> schedule.</p></div>`;b&&(b.innerHTML=e),S&&(S.innerHTML=e),p&&(p.innerHTML="<option>Route not available</option>")}window.openLegal=function(t){Ge&&(Ge.textContent=t==="terms"?"Terms of Use":"Privacy Policy"),qe&&(qe.innerHTML=kt[t]),B&&B.classList.remove("hidden"),te&&te.classList.remove("open"),R&&R.classList.remove("open"),document.body.classList.remove("sidenav-open")};const Ee=()=>{B&&B.classList.add("hidden")};function Mt(){localStorage.theme==="light"?(document.documentElement.classList.remove("dark"),Q.classList.add("hidden"),X.classList.remove("hidden")):(localStorage.theme="dark",document.documentElement.classList.add("dark"),Q.classList.remove("hidden"),X.classList.add("hidden")),Ce&&Ce.addEventListener("click",()=>{localStorage.theme==="dark"?(localStorage.theme="light",document.documentElement.classList.remove("dark"),Q.classList.add("hidden"),X.classList.remove("hidden")):(localStorage.theme="dark",document.documentElement.classList.add("dark"),Q.classList.remove("hidden"),X.classList.add("hidden"))}),Re&&Re.addEventListener("click",async()=>{const n={title:"Metrorail Next Train",text:`Say Goodbye to Waiting
Use Next Train to check when your train is due to arrive`,url:`

https://nexttrain.co.za`};try{navigator.share?await navigator.share(n):nt(n.text+n.url)}catch{nt(n.text+n.url)}}),window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),ye=n,Y&&(Y.classList.remove("hidden"),Y.addEventListener("click",()=>{Y.classList.add("hidden"),ye.prompt(),ye=null}))});const t=()=>{te.classList.add("open"),R.classList.add("open"),document.body.classList.add("sidenav-open")};Pe&&Pe.addEventListener("click",t),Ue&&Ue.addEventListener("click",t);const e=()=>{te.classList.remove("open"),R.classList.remove("open"),document.body.classList.remove("sidenav-open")};Je&&Je.addEventListener("click",e),R&&R.addEventListener("click",e),Fe&&Fe.addEventListener("click",n=>{const r=n.target.closest("a");if(r&&r.dataset.routeId){const a=r.dataset.routeId;if(a===N){x("You are already viewing this route.","info",1500),e();return}document.querySelectorAll("#route-list a").forEach(i=>i.classList.remove("active")),r.classList.add("active"),e(),N=a,ne()}}),_&&_.addEventListener("click",()=>{x("Forcing schedule reload...","info",2e3),ne(!0)}),G&&G.addEventListener("click",()=>{localStorage.getItem("defaultRoute")===N?(localStorage.removeItem("defaultRoute"),x("Route unpinned from top.","info",2e3)):(localStorage.setItem("defaultRoute",N),x("Route pinned to top of menu!","success",2e3)),Ze()})}function Ze(){const t=localStorage.getItem("defaultRoute");G&&(t===N?($e.classList.add("hidden"),He.classList.remove("hidden"),G.title="Unpin this route"):($e.classList.remove("hidden"),He.classList.add("hidden"),G.title="Pin this route as default")),Z&&(t&&$[t]?(Z.classList.remove("hidden"),Z.innerHTML=`<li class="route-category mt-0 pt-0 text-blue-500 dark:text-blue-400">Pinned Route</li><li class="route-item"><a class="${t===N?"active":""}" data-route-id="${t}"><span class="route-dot dot-green"></span>${$[t].name}</a></li>`):Z.classList.add("hidden"))}function Dt(){const t=()=>{C.classList.add("hidden"),document.body.style.overflow=""};Be&&Be.addEventListener("click",t),Me&&Me.addEventListener("click",t),C&&C.addEventListener("click",e=>{e.target===C&&t()})}window.openScheduleModal=function(t){if(!F||!F[t]){x("No full schedule data available.","error");return}const e=F[t];Oe&&(Oe.textContent=`Schedule to ${t.replace(" STATION","")}`),W&&(W.innerHTML="");const n=h(me);let r=!1;e.forEach(a=>{const i=a.departureTime||a.train1.departureTime,s=a.train||a.train1.train,o=a.type==="transfer"?"Transfer":"Direct",l=h(i)<n;let f="p-3 rounded shadow-sm flex justify-between items-center transition-opacity duration-300";l?f+=" bg-gray-50 dark:bg-gray-800 opacity-50 grayscale":f+=" bg-white dark:bg-gray-700";const u=document.createElement("div");u.className=f,!l&&!r&&(u.id="next-train-marker",r=!0),u.innerHTML=`<div><span class="text-lg font-bold text-gray-900 dark:text-white">${i}</span><div class="text-xs text-gray-500 dark:text-gray-400">Train ${s}</div></div><div class="flex flex-col items-end gap-1">${o==="Direct"?'<span class="text-[10px] font-bold text-green-700 bg-green-100 dark:text-green-300 dark:bg-green-900 px-2 py-0.5 rounded-full uppercase">Direct</span>':`<span class="text-[10px] font-bold text-orange-700 bg-orange-100 dark:text-orange-300 dark:bg-orange-900 px-2 py-0.5 rounded-full uppercase">Transfer @ ${a.train1.terminationStation.replace(" STATION","")}</span>`} ${a.isLastTrain?'<span class="text-[10px] font-bold text-red-600 bg-red-100 dark:text-red-300 dark:bg-red-900 px-2 py-0.5 rounded-full uppercase border border-red-200 dark:border-red-800">LAST TRAIN</span>':""}</div>`,W&&W.appendChild(u)}),C&&C.classList.remove("hidden"),document.body.style.overflow="hidden",setTimeout(()=>{const a=document.getElementById("next-train-marker");a&&a.scrollIntoView({behavior:"auto",block:"start"})},10)};function Ct(){Ke&&Ke.addEventListener("click",t=>{t.preventDefault(),lt("https://docs.google.com/forms/d/e/1FAIpQLSe7lhoUNKQFOiW1d6_7ezCHJvyOL5GkHNH1Oetmvdqgee16jw/viewform","Open Google Form to send feedback?")}),ue&&ue.addEventListener("click",t=>{t.preventDefault(),lt(ue.href,"Visit Facebook for official updates?")})}function lt(t,e){De&&(De.textContent=e),V&&V.classList.remove("hidden");const n=()=>{window.open(t,"_blank"),V.classList.add("hidden"),a()},r=()=>{V.classList.add("hidden"),a()},a=()=>{le.removeEventListener("click",n),de.removeEventListener("click",r)};le&&le.addEventListener("click",n),de&&de.addEventListener("click",r)}document.addEventListener("DOMContentLoaded",()=>{p=document.getElementById("station-select"),b=document.getElementById("pretoria-time"),S=document.getElementById("pienaarspoort-time"),U=document.getElementById("pretoria-header"),K=document.getElementById("pienaarspoort-header"),Ae=document.getElementById("current-time"),_e=document.getElementById("current-day"),I=document.getElementById("loading-overlay"),A=document.getElementById("main-content"),z=document.getElementById("offline-indicator"),C=document.getElementById("schedule-modal"),Oe=document.getElementById("modal-title"),W=document.getElementById("modal-list"),Be=document.getElementById("close-modal-btn"),Me=document.getElementById("close-modal-btn-2"),V=document.getElementById("redirect-modal"),De=document.getElementById("redirect-message"),le=document.getElementById("redirect-confirm-btn"),de=document.getElementById("redirect-cancel-btn"),Ce=document.getElementById("theme-toggle-btn"),Q=document.getElementById("theme-toggle-dark-icon"),X=document.getElementById("theme-toggle-light-icon"),Re=document.getElementById("share-app-btn"),Y=document.getElementById("install-app-btn"),_=document.getElementById("force-reload-btn"),G=document.getElementById("pin-route-btn"),$e=document.getElementById("pin-outline"),He=document.getElementById("pin-filled"),Pe=document.getElementById("open-nav-btn"),Je=document.getElementById("close-nav-btn"),te=document.getElementById("sidenav"),R=document.getElementById("sidenav-overlay"),Fe=document.getElementById("route-list"),Ue=document.getElementById("route-subtitle"),ce=document.getElementById("route-subtitle-text"),Z=document.getElementById("pinned-section"),L=document.getElementById("toast"),ue=document.getElementById("check-updates-btn"),Ke=document.getElementById("feedback-btn"),j=document.getElementById("last-updated-date"),xe=document.getElementById("sim-panel"),et=document.getElementById("sim-enabled"),he=document.getElementById("sim-time"),tt=document.getElementById("sim-day"),be=document.getElementById("sim-apply-btn"),Se=document.getElementById("app-title"),M=document.getElementById("pin-modal"),D=document.getElementById("pin-input"),Ie=document.getElementById("pin-cancel-btn"),ke=document.getElementById("pin-submit-btn"),B=document.getElementById("legal-modal"),Ge=document.getElementById("legal-modal-title"),qe=document.getElementById("legal-modal-content"),we=document.getElementById("close-legal-btn"),Le=document.getElementById("close-legal-btn-2"),we&&we.addEventListener("click",Ee),Le&&Le.addEventListener("click",Ee),B&&B.addEventListener("click",e=>{e.target===B&&Ee()}),Se&&Se.addEventListener("click",()=>{ie++,ve&&clearTimeout(ve),ve=setTimeout(()=>{ie=0},1e3),ie>=5&&(ie=0,M&&M.classList.remove("hidden"),D&&(D.value="",D.focus()))}),Ie&&Ie.addEventListener("click",()=>{M&&M.classList.add("hidden")}),ke&&ke.addEventListener("click",()=>{D.value==="101101"?(M&&M.classList.add("hidden"),xe&&xe.classList.remove("hidden"),x("Developer Mode Unlocked!","success")):(x("Invalid PIN","error"),D&&(D.value=""))}),be&&be.addEventListener("click",()=>{if(ee=et.checked,ut=he.value+":00",ft=parseInt(tt.value),ee&&!he.value){x("Please enter a time first!","error");return}x(ee?"Dev Simulation Active!":"Real-time Mode Active","success"),We()});const t=localStorage.getItem("defaultRoute");t&&$[t]&&(N=t),ne(),p&&p.addEventListener("change",ae),Mt(),Ze(),Dt(),Ct(),mt(),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"geolocation"}).then(function(e){e.state==="granted"&&yt()})});window.onerror=function(t,e,n){return console.error("Global Error Caught:",t),I&&(I.style.display="none"),A&&(A.style.display="block"),L&&(L.textContent="App crashed. Resetting...",L.className="toast-info toast-error show",setTimeout(()=>{localStorage.removeItem("full_db"),location.reload()},2e3)),!1};setTimeout(()=>{I&&I.style.display!=="none"&&(console.warn("Loader timed out. Forcing hide."),I.style.display="none",A&&(A.style.display="block"),localStorage.removeItem("full_db"))},5e3);
