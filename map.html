<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrorail Network Map - Active Routes</title>
    
    <!-- FAVICONS -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png?v=6">
    <link rel="apple-touch-icon" href="icons/icon-192.png?v=6">
    <link rel="shortcut icon" href="icons/icon-192.png?v=6" type="image/png">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>
      
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        #map { height: 100vh; width: 100%; z-index: 1; }
        .legend {
            padding: 10px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            line-height: 24px;
            color: #333;
            font-family: 'Inter', sans-serif;
            max-width: 250px;
        }
        .legend h4 {
            margin: 0 0 5px;
            color: #1f2937;
            font-weight: 800;
            font-size: 14px;
            text-transform: uppercase;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.9;
            border-radius: 4px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-badge {
            display: inline-block;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 4px;
            margin-left: auto;
            font-weight: bold;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Back Button Overlay -->
    <div class="fixed top-4 left-4 z-50">
        <a href="index.html" class="bg-white hover:bg-gray-100 text-gray-800 font-bold py-2 px-4 border border-gray-300 rounded-lg shadow-lg flex items-center transition-transform transform active:scale-95">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            Back to App
        </a>
    </div>

    <div id="map"></div>

    <script>
        // Initialize Map centered on Gauteng (Between JHB and PTA)
        // Zoom Control moved to bottomright to avoid conflict with "Back to App" button
        const map = L.map('map', { zoomControl: false }).setView([-26.05, 28.15], 10); 
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // Add OpenStreetMap Tile Layer (Light Theme)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // --- DEFINE COORDINATES ---
        const ptaStation = [-25.7593, 28.1887];
        const jhbStation = [-26.195, 28.040];
        const germistonStation = [-26.215, 28.170];
        const kemptonStation = [-26.100, 28.240];
        const belleOmbreStation = [-25.742, 28.180];
        
        // --- ACTIVE ROUTES ---

        // 1. PTA - Pienaarspoort (Green)
        const route_pta_pien = [
            ptaStation,
            [-25.746, 28.220], 
            [-25.733, 28.267], // Koedoespoort
            [-25.730, 28.310], // Silverton
            [-25.728, 28.360], 
            [-25.725, 28.420]  // Pienaarspoort
        ];

        // 2. PTA - Mabopane (Orange)
        const route_pta_mabopane = [
            ptaStation,
            [-25.735, 28.170], 
            [-25.700, 28.160], // Hercules Hub
            [-25.650, 28.140], 
            [-25.600, 28.120], 
            [-25.550, 28.100], 
            [-25.500, 28.080]  // Mabopane
        ];

        // 3. PTA - De Wildt (Purple)
        const route_pta_dewildt = [
            [-25.600, 28.120], // Wintersnest (Split from Mabopane line)
            [-25.610, 28.050], 
            [-25.620, 28.000], 
            [-25.630, 27.950]  // De Wildt
        ];

        // 4. Germiston - Leralla (Blue)
        const route_germ_leralla = [
             germistonStation,
             [-26.150, 28.180], 
             kemptonStation, 
             [-26.050, 28.230], 
             [-26.020, 28.210]  // Leralla
        ];

        // 5. JHB - Germiston (Red - JHB Core)
        const route_jhb_germ = [
            jhbStation,
            [-26.205, 28.080], // Jeppe / Ellis Park area
            [-26.210, 28.120], 
            germistonStation
        ];

        // 6. PTA - Kempton Park (Blue - South Line)
        const route_pta_kempton = [
            ptaStation,
            [-25.780, 28.200], 
            [-25.850, 28.220], // Centurion area
            [-25.950, 28.230], // Olifantsfontein
            [-26.000, 28.240], // Kaalfontein
            kemptonStation
        ];

        // 7. Mabopane - Belle Ombre (Orange Variant)
        const route_mab_belle = [
            belleOmbreStation,
            [-25.720, 28.170], // Connecting to Hercules
            [-25.700, 28.160], // Merge with PTA line at Hercules
            [-25.650, 28.140], 
            [-25.600, 28.120], 
            [-25.550, 28.100], 
            [-25.500, 28.080]  // Mabopane
        ];

        // 8. Germiston - Kwesine (Yellow - East Line)
        const route_germ_kwesine = [
            germistonStation,
            [-26.230, 28.180], // India Junction
            [-26.260, 28.190], // Wattles
            [-26.300, 28.200], // Katlehong
            [-26.330, 28.210]  // Kwesine
        ];

        // --- DRAW FUNCTIONS ---

        function addRoute(latlngs, color, name, isActive = true) {
            const opacity = isActive ? 0.9 : 0.4;
            const weight = isActive ? 5 : 3;
            const dashArray = isActive ? null : '5, 10';
            const finalColor = isActive ? color : '#9ca3af';

            L.polyline(latlngs, {
                color: finalColor,
                weight: weight,
                opacity: opacity,
                dashArray: dashArray,
                smoothFactor: 1
            }).addTo(map).bindPopup(`<b>${name}</b><br>${isActive ? '<span class="text-green-600 font-bold">Active Service</span>' : '<span class="text-red-500 font-bold">Suspended</span>'}`);
        }

        // --- RENDER ROUTES ---
        addRoute(route_pta_pien, '#22c55e', 'Pretoria - Pienaarspoort', true);
        addRoute(route_pta_mabopane, '#f97316', 'Pretoria - Mabopane', true);
        addRoute(route_mab_belle, '#f97316', 'Belle Ombre - Mabopane', true); 
        addRoute(route_pta_dewildt, '#a855f7', 'Pretoria - De Wildt', true);
        addRoute(route_germ_leralla, '#3b82f6', 'Germiston - Leralla', true);
        addRoute(route_jhb_germ, '#ef4444', 'JHB - Germiston', true);
        addRoute(route_pta_kempton, '#3b82f6', 'Pretoria - Kempton Park', true); 
        addRoute(route_germ_kwesine, '#eab308', 'Germiston - Kwesine', true); // Yellow

        // --- MARKERS ---
        const hubs = [
            { name: "Pretoria Station", coords: ptaStation, type: 'hub' },
            { name: "Johannesburg Park", coords: jhbStation, type: 'hub' },
            { name: "Germiston", coords: germistonStation, type: 'hub' },
            { name: "Kempton Park", coords: kemptonStation, type: 'hub' },
            { name: "Belle Ombre", coords: belleOmbreStation, type: 'hub' }, 
            { name: "Mabopane", coords: [-25.500, 28.080], type: 'end' },
            { name: "De Wildt", coords: [-25.630, 27.950], type: 'end' },
            { name: "Pienaarspoort", coords: [-25.725, 28.420], type: 'end' },
            { name: "Leralla", coords: [-26.020, 28.210], type: 'end' },
            { name: "Kwesine", coords: [-26.330, 28.210], type: 'end' } // Added
        ];

        hubs.forEach(hub => {
            const radius = hub.type === 'hub' ? 8 : 5;
            const weight = hub.type === 'hub' ? 3 : 2;
            
            L.circleMarker(hub.coords, {
                radius: radius,
                fillColor: "#ffffff",
                color: "#1f2937",
                weight: weight,
                opacity: 1,
                fillOpacity: 1
            }).addTo(map).bindPopup(`<b>${hub.name}</b>`);
        });

        // --- LEGEND (UPDATED) ---
        const legend = L.control({position: 'topright'});

        legend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'legend');
            const items = [
                { color: '#22c55e', text: 'Pretoria - Pienaarspoort', status: 'LIVE', bg: 'bg-green-500' },
                { color: '#f97316', text: 'Pretoria - Mabopane', status: 'LIVE', bg: 'bg-green-500' },
                { color: '#f97316', text: 'Mabopane - Belle Ombre', status: 'LIVE', bg: 'bg-green-500' },
                { color: '#a855f7', text: 'Pretoria - De Wildt', status: 'LIVE', bg: 'bg-green-500' },
                { color: '#3b82f6', text: 'Pretoria - Kempton Park', status: 'LIVE', bg: 'bg-green-500' },
                { color: '#3b82f6', text: 'Germiston - Leralla', status: 'LIVE', bg: 'bg-green-500' },
                { color: '#ef4444', text: 'JHB - Germiston', status: 'LIVE', bg: 'bg-green-500' },
                { color: '#eab308', text: 'Germiston - Kwesine', status: 'LIVE', bg: 'bg-green-500' }
            ];

            div.innerHTML += '<h4>Network Status</h4>';
            
            for (let i = 0; i < items.length; i++) {
                div.innerHTML += `
                    <div class="legend-item">
                        <i style="background:${items[i].color}"></i>
                        <span>${items[i].text}</span>
                        <span class="status-badge ${items[i].bg}">${items[i].status}</span>
                    </div>
                `;
            }
            return div;
        };

        legend.addTo(map);

    </script>
</body>
</html>